(function(){var t,e,n,r,o=[].slice,i=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty,a=function(t,e){return function(){return t.apply(e,arguments)}};if(e=function(){function t(t,e,n,r){this.root=t,this.require=n,this.$=r,this.prevTweak=this.root.tweak||e}return t.prototype["extends"]=i,t.prototype.bind=a,t.prototype["super"]=function(){var t,e,n,r;return t=arguments[0],e=arguments[1],r=arguments[2],n=4<=arguments.length?o.call(arguments,3):[],t.__super__[e].apply(r,n)},t.prototype.noConflict=function(){var e;return pTweak&&(e=t=this.pTweak),this},t.prototype.clone=function(t,e){var n,r,o;if(null==t||"object"!=typeof t||t===e)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return r="",null!=t.global&&(r+="g"),null!=t.ignoreCase&&(r+="i"),null!=t.multiline&&(r+="m"),null!=t.sticky&&(r+="y"),new RegExp(t.source,r);n=t instanceof Array?[]:{};for(o in t)t.hasOwnProperty(o)&&(n[o]=this.clone(t[o],t));return n},t.prototype.combine=function(t,e){var n,r;for(n in e)r=e[n],"object"==typeof r?(null==t[n]&&(t[n]=r instanceof Array?[]:{}),t[n]=this.combine(t[n],r)):t[n]=r;return t},t.prototype.JSON=function(t){return JSON["string"==typeof t?"parse":"stringify"](t)},t.prototype.findModule=function(t,e,n){var r,o,i,s;for(i=0,s=t.length;s>i;i++){r=t[i];try{return this.request(r,e)}catch(a){if(o=a,"Error"!==o.name)throw o}}if(null!=n)return n;throw new Error("No module "+e+" for "+t[0])},t.prototype.request=function(t,e,n){var r,o;o=this.toAbsolute(t,e);try{return this.require(o)}catch(i){if(r=i,null!=n)return n;throw r}},t.prototype.splitPaths=function(t){var e,n,r,o,i,s,a,l,u,h,p,c,f,d;for(c=/^(.*)\[(\d*)(?:[,\-](\d*)){0,1}\](.*)$/,"string"==typeof t&&(t=t.split(/\s+/)),f=[],e=0,r=t.length;r>e;e++)if(l=t[e],o=c.exec(l),null!=o)for(u=o[0],s=o[1],i=o[2],d=o[3],a=n=h=s||0,p=i||s;p>=h?p>=n:n>=p;a=p>=h?++n:--n)f.push(""+u+a+d);else f.push(l);return f},t.prototype.toAbsolute=function(t,e){var n,r,o,i;return n=/^(\.+[\/\\]*)+/,i=/^\.{2,}[\/\\]*/,r=e.split(i).length-1||0,o=RegExp("([\\/\\\\]*[^\\/\\\\]+){"+r+"}[\\/\\\\]?$"),e.replace(n,t.replace(o,"")+"/")},t}(),n="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||window,"function"==typeof define&&define.amd)define(["$","exports"],function(t,r){var o;return o=function(t){return define([t],function(t){return t})},r=e=n.tweak=n.Tweak=new e(n,r,o,t)});else if("undefined"!=typeof exports){try{t=require("$")}catch(l){}if(!t)try{t=require("jquery")}catch(l){}"undefined"!=typeof module&&null!==module&&(module.exports=r=e=new e(n,exports,require,t))}else e=n.tweak=n.Tweak=new e(n,{},n.require,n.jQuery||n.Zepto||n.ender||n.$);e.Events=function(){function t(){}return t.prototype.findEvent=function(t,e){var n,r,o,i,s,a;for(null==e&&(e=!1),"string"==typeof t&&(t=t.split(/\s+/)),r=this.__events=this.__events||{},a=[],i=0,s=t.length;s>i;i++){if(o=t[i],!(n=r[o])){if(!e)continue;n=this.__events[o]={name:o,__callbacks:[]}}a.push(n)}return a},t.prototype.addEvent=function(t,e,n,r){var o,i,s,a,l,u,h,p,c;for(null==n&&(n=this),("number"==typeof n||null===n)&&(r=n,n=r||this),p=this.findEvent(t,!0),a=0,u=p.length;u>a;a++){for(o=p[a],i=!1,c=o.__callbacks,l=0,h=c.length;h>l;l++)s=c[l],s.callback===e&&n===s.ctx&&(s.max=r,s.calls=0,s.listen=i=!0);i||o.__callbacks.push({ctx:n,callback:e,max:r,calls:0,listen:!0})}},t.prototype.removeEvent=function(t,e,n){var r,o,i,s,a,l,u;for(null==n&&(n=this),l=this.findEvent(t),i=0,a=l.length;a>i;i++){r=l[i],u=r.__callbacks;for(s in u)o=u[s],null!=e&&e!==o.callback||null!=n&&n!==o.ctx||r.__callbacks.splice(s,1);0===r.__callbacks.length&&delete this.__events[r.name]}},t.prototype.triggerEvent=function(){var t,e,n,r,i,s,a,l,u,h,p;for(l=arguments[0],u=2<=arguments.length?o.call(arguments,1):[],"object"==typeof l&&!l instanceof Array&&(l=l.names||[],t=l.context||null),h=this.findEvent(l),r=0,s=h.length;s>r;r++)for(e=h[r],p=e.__callbacks,i=0,a=p.length;a>i;i++)n=p[i],!n.listen||null!=t&&t!==n.ctx||(null!=n.max&&++n.calls>=n.max&&(n.listen=!1),setTimeout(function(){this.callback.apply(this.ctx,u)}.bind(n),0))},t.prototype.updateEvent=function(t,e){var n,r,o,i,s,a,l,u,h,p,c,f,d,g;for(null==e&&(e={}),o=e.context,c=e.max,g=e.reset,r=g?0:e.calls||0,p=e.listen,n=e.callback,f=this.findEvent(t),a=0,u=f.length;u>a;a++)for(i=f[a],d=i.__callbacks,l=0,h=d.length;h>l;l++)s=d[l],null!=o&&o===s.ctx||null!=n&&n===s.callback||(null!=c&&(s.max=c),null!=r&&(s.calls=r),null!=p&&(s.listen=p))},t.prototype.resetEvents=function(){return this.__events={}},t}(),e.Store=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype._type="BASE",e.prototype.length=0,e.prototype.init=function(){},e.prototype.set=function(){var t,e,n,r,i,s,a,l,u,h;t=arguments[0],i=2<=arguments.length?o.call(arguments,1):[],u=i[0],h=typeof t,("string"===h||"number"===h)&&(a=t,t={},t[a]=i[0],u=i[1]),r={};for(e in t)l=t[e],s=this._data[e],null==s&&this.length++,this._data[e]=("function"==typeof this[n="__set"+e.replace(/^[a-z]/,function(t){return t.toUpperCase()})]?this[n](l):void 0)||l,u||this.triggerEvent("changed:"+e,l);u||this.triggerEvent("changed")},e.prototype.same=function(t,e){var n,r;for(n in t)if(r=t[n],null==e[n]||e[n]!==r)return!1;return!0},e.prototype.get=function(){var t,e,n,r,i,s,a,l,u,h;for(l=arguments[0],h=2<=arguments.length?o.call(arguments,1):[],null==l&&(l=function(){var t,e;t=this._data,e=[];for(s in t)r=t[s],e.push(s);return e}.call(this)),("string"==typeof l||"number"==typeof l)&&(l=[l]),t=this._data instanceof Array?[]:{},n=i=0,a=l.length;a>i;n=++i)r=l[n],e="function"==typeof this[u="__get"+(""+r).replace(/^[a-z]/,function(t){return t.toUpperCase()})]?this[u].apply(this,h):void 0,null==e&&(e=this._data[r]),t[r]=e;return 1>=n&&(t=t[r]),t},e.prototype.has=function(t,e){var n,r,o,i,s,a;for(("string"==typeof t||"number"==typeof t)&&(t=[t]),r=i=0,s=t.length;s>i;r=++i)if(o=t[r],n="function"==typeof this[a="__get"+o.replace(/^[a-z]/,function(t){return t.toUpperCase()})]?this[a].apply(this,e):void 0,null==n&&null==this._data[o])return!1;return!0},e.prototype.where=function(t){var e,n,r,o;o=[],e=this._data;for(n in e)r=e[n],r===t&&o.push(n);return o},e.prototype.reset=function(){this.length=0,this.triggerEvent("changed")},e.prototype["import"]=function(t,e){var n,r,o;null==e&&(e=!0);for(r in t)n=t[r],null!=(null!=(o=this._data[r])?o["import"]:void 0)?this._data[r]["import"](n,e):this.set(r,n,e)},e.prototype["export"]=function(t){var e,n,r,o,i;for(i={},null==t&&(t=function(){var t,n;t=this._data,n=[];for(r in t)e=t[r],n.push(r);return n}.call(this)),n=0,o=t.length;o>n;n++)r=t[n],null!=(e=this.get(r))&&(i[r]=null!=e["export"]?e["export"]():e);return i},e}(e.Events),e.Model=function(t){function e(t){this._data=null!=t?t:{}}return i(e,t),e.prototype._type="model",e.prototype.remove=function(t,e){var n,r,o,i,s,a;for("string"==typeof t&&(t=[t]),n=0,o=t.length;o>n;n++){s=t[n],a=this._data;for(r in a)i=a[r],r===s&&(this.length--,delete this._data[r],e||this.triggerEvent("removed:"+r))}e||this.triggerEvent("changed")},e.prototype.pluck=function(t){var e,n,r,o;o=[],r=this._data;for(e in r)n=r[e],n===t&&o.push(e);return o},e.prototype.reset=function(){this._data={},e.__super__.reset.call(this)},e}(e.Store),e.View=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return i(r,n),t=e.$,r.prototype.init=function(){},r.prototype.template=function(t){var n,r;return((null!=(r=n=this.component.config.view)?r.template:void 0)?e.request(n.template):e.findModule(this.component.paths,"./template"))(t)},r.prototype.attach=function(e,n){var r,o,i,s,a,l,u,h,p;switch(n=t(n)[0],a=null!=(u=this.component.config.view)&&null!=(h=u.attach)?h.method:void 0){case"prefix":case"before":return e.insertBefore(n,e.firstChild),e.firstElementChild;case"replace":for(p=e.children,i=0,s=p.length;s>i;i++){o=p[i];try{e.removeChild(o)}catch(c){r=c}}return e.appendChild(n),e.firstElementChild;default:return/^\d+$/.test(""+a)?(l=Number(a),e.insertBefore(n,e.children[l]),e.children[l]):(e.appendChild(n),e.lastElementChild)}},r.prototype.isAttached=function(t,e){return null==t&&(t=this.el),null==e&&(e=document.documentElement),e.contains(t)},r.prototype.render=function(n){var r,o,i,s,a,l,u,h,p;return this.isAttached()&&!n?this.triggerEvent("rendered"):(s=this.component.config.view,r=function(n){return function(r){var o,i,a,l;return i=null,r?(o=function(t){var r,o,s,l,u,h;for(u=[],o=0,s=t.length;s>o&&(l=t[o],!i);o++)r=l.getAttribute("data-attach"),u.push(null==r||r.match(/\s+/)?void 0:function(){var t,n,o,s;for(o=e.splitPaths(r),s=[],t=0,n=o.length;n>t;t++){if(h=o[t],h=e.toAbsolute(this.component.parent.name||"",h),a===h){i=l;break}s.push(void 0)}return s}.call(n));return u},a=(null!=(l=s.attach)?l.to:void 0)||n.component.name,o(r),o(t("[data-attach]",r)),i):void 0}}(this),u=null!=(h=this.component.parent)&&null!=(p=h.view)?p.el:void 0,o=r(u)||r(document.documentElement)||u||document.documentElement,this.$el=t(this.attach(o,this.template(this.component.config.view.data||this.model._data))),this.el=this.$el[0],l=e.clone(this.component.paths),-1===l.indexOf(this.component.name)&&l.unshift(this.component.name),i=function(){var t,e,n;for(n=[],t=0,e=l.length;e>t;t++)a=l[t],n.push(a.replace(/[\/\\]/g,"-"));return n}(),this.$el.addClass(i.join(" ")),n||this.triggerEvent("rendered"),void this.init())},r.prototype.clear=function(e){null==e&&(e=this.el),t(e).remove()},r.prototype.element=function(e,n){var r,o,i,s;if(null==n&&(n=this.el),e instanceof Array){for(s=[],o=0,i=e.length;i>o;o++)r=e[o],s.push(t(r,n));return s}return t(e,n)},r}(e.Events),e.Controller=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.init=function(){},e}(e.Events),e.Collection=function(t){function e(t){this._data=null!=t?t:[]}var n;return i(e,t),e.prototype._type="collection",n=function(t,e){var n,r;for(r in t)n=t[r],e("changed:"+r,n);return triggerEvent("changed",t)},e.prototype.add=function(t,e){this.set(this.length,t,e)},e.prototype.at=function(t){return this.get(t)},e.prototype.push=function(t,e){this.set(this.length,t,e)},e.prototype.splice=function(t,e,r,i){var s;null==i&&(i=!1),(s=this._data).splice.apply(s,[t,e].concat(o.call(r))),this.length=this._data.length,i||n(this._data,this.triggerEvent)},e.prototype.insert=function(t,e,n){this.splice(position,0,e,n)},e.prototype.unshift=function(t,e){return this.splice(0,0,t,e),this.length},e.prototype.remove=function(t,e){var n,r,o;for(t instanceof Array||(t=[t]),r=0,o=t.length;o>r;r++)n=t[r],this._data.splice(n,1),e||this.triggerEvent("removed:"+n);e||this.triggerEvent("changed")},e.prototype.removeAt=function(t,e){var n,r,o;n=this.at(t);for(r in n)o=n[r],this.remove(r,e)},e.prototype.pop=function(t){var e,n;return e=this.length-1,n=this._data[e],this.remove(e,t),n},e.prototype.shift=function(t){var e;return e=this._data[0],this.remove(0,t),e},e.prototype.reduce=function(t,e){this.splice(0,t,e)},e.prototype.reduceRight=function(t,e){this.splice(0,this.length-t,e)},e.prototype.indexes=function(t){var e,n,r,o;r=this._data,o=[];for(e in r)n=r[e],t===n&&o.push(e);return o},e.prototype.concat=function(t,e){var n;this.splice(this.length-1,0,(n=[]).concat.apply(n,t),e)},e.prototype.reset=function(){this._data=[],e.__super__.reset.call(this)},e.prototype.every=function(){return this._data.every(arguments)},e.prototype.filter=function(){return this._data.filter(arguments)},e.prototype.forEach=function(){return this._data.forEach(arguments)},e.prototype.join=function(){return this._data.join(arguments)},e.prototype.map=function(){return this._data.map(arguments)},e.prototype.reverse=function(t){var e;return e=this._data.reverse(),t||n(this._data,this.triggerEvent),e},e.prototype.slice=function(){return this._data.slice(arguments)},e.prototype.some=function(){return this._data.some(arguments)},e.prototype.sort=function(t,e){var r;return null==e&&(e=!1),r=null!=t?this._data.sort(t):this._data.sort(),n(this._data,this.triggerEvent),r},e}(e.Store),e.Component=function(){function t(t,n){var r,o,i,s,a,l,u,h,p,c;if(null==n)throw new Error("No options given");if(t=this.relation=t===window?{}:t,null==t.relation&&(t.relation={}),this.parent=t instanceof e.Component?t:t.component||t,this.root=this.parent.root||this,this.name=n.name,null==this.name)throw new Error("No name given");for(n.name=this.name=e.toAbsolute(this.parent.name||"",this.name),this.config=this.__buildConfig(n),this.config.router&&this.__addRouter(),this.__addModel(),this.__addView(),this.__addComponents(),this.__addController(),p=this.modules,r=0,i=p.length;i>r;r++)if(a=p[r],u=this[a])for(u.parent=this.parent,u.component=this,c=this.modules,o=0,s=c.length;s>o;o++)l=c[o],a!==l&&(h=this[l])&&(u[l]=h)}return t.prototype.model=null,t.prototype.view=null,t.prototype.components=null,t.prototype.controller=null,t.prototype.router=null,t.prototype.modules=["controller","model","view","router","components"],t.prototype.init=function(){var t,e,n,r,o;for(o=this.modules,e=0,n=o.length;n>e;e++)r=o[e],"view"!==r&&(t=this[r])&&"function"==typeof t.init&&t.init()},t.prototype.__buildConfig=function(t){var n,r,o,i,s,a,l,u,h,p;for(n=[],a=this.paths=[],r=this.name,t&&(n.push(e.clone(t)),t["extends"]&&(r=t["extends"])),s=(null!=(l=this.parent)?l.name:void 0)||this.name;r;)h=e.request(s,r+"/config",e.strict?null:{}),a.push(e.toAbsolute(s,r)),n.push(e.clone(h)),r=h["extends"];for(p=n[n.length-1],o=i=u=n.length-1;0>=u?0>=i:i>=0;o=0>=u?++i:--i)p=e["extends"](p,n[o]);return null==p.model&&(p.model={}),null==p.view&&(p.view={}),null==p.controller&&(p.controller={}),null==p.components&&(p.components=[]),null==p.events&&(p.events={}),p},t.prototype.__addModule=function(){var t,n,r,i,s;r=arguments[0],s=arguments[1],i=3<=arguments.length?o.call(arguments,2):[],t=e.findModule(this.paths,"./"+r,s),n=this[r]=function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(t,[this.config[r]].concat(o.call(i)),function(){}),n.component=this,n.root=this.root},t.prototype.__addView=function(){var t;t=1<=arguments.length?o.call(arguments,0):[],this.__addModule.apply(this,["view",e.View].concat(o.call(t)))},t.prototype.__addModel=function(){var t;t=1<=arguments.length?o.call(arguments,0):[],this.__addModule.apply(this,["model",e.Model].concat(o.call(t)))},t.prototype.__addController=function(){var t;t=1<=arguments.length?o.call(arguments,0):[],this.__addModule.apply(this,["controller",e.Controller].concat(o.call(t)))},t.prototype.__addComponents=function(){var t;t=1<=arguments.length?o.call(arguments,0):[],this.__addModule.apply(this,["components",e.Components].concat(o.call(t)))},t.prototype.__addRouter=function(){var t;t=1<=arguments.length?o.call(arguments,0):[],this.__addModule.apply(this,["router",e.Router].concat(o.call(t)))},t.prototype.__componentRender=function(t){this.view.addEvent(t+"ed",function(){return this.components.addEvent("ready",function(){return this.controller.triggerEvent("ready")},this,1),this.components[t]()},this,1),this.view[t]()},t.prototype.render=function(){var t;t=this.name,this.__componentRender("render")},t.prototype.rerender=function(){this.__componentRender("rerender")},t.prototype.destroy=function(t){var e,n,r,o,i,s;if(this.view.clear(),e=this.relation.components,null!=e)for(n=0,s=e.data,o=0,i=s.length;i>o;o++){if(r=s[o],r.uid===this.uid)return void e.remove(n,t);n++}},t.prototype.findEvent=function(t,e){return this.controller.findEvent(t,e)},t.prototype.addEvent=function(t,e,n,r){return this.controller.addEvent(t,e,n,r)},t.prototype.removeEvent=function(t,e,n){return this.controller.removeEvent(t,e,n)},t.prototype.triggerEvent=function(){var t,e,n;return t=arguments[0],e=2<=arguments.length?o.call(arguments,1):[],(n=this.controller).triggerEvent.apply(n,[t].concat(o.call(e)))},t.prototype.updateEvent=function(t,e){return this.controller.updateEvent(t,e)},t.prototype.resetEvents=function(){return this.controller.resetEvents()},t.prototype["export"]=function(t){var e;return("function"==typeof(e=this.controller)["export"]?e["export"]():void 0)||{model:this.model["export"](t,{components:this.components["export"]()})}},t.prototype["import"]=function(t){return null!=this.controller["import"]?this.controller["import"](t):(t.model&&this.model["import"](t.model),t.components?this.components["import"](t.components):void 0)},t}(),e.Components=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype._type="components",n.prototype.init=function(){var t,n,r,o,i,s,a,l,u,h,p,c,f,d,g,m,_,v,y,E;for(this._data=[],i=[],t=function(t){return function(n){return e.toAbsolute(t.component.name,n)}}(this),o=function(){return function(n){var r,o,i,s,a;for(s=e.splitPaths(n),a=[],r=0,o=s.length;o>r;r++)i=s[r],a.push(t(i));return a}}(this),n=function(t){return function(e){return t._data.push(e),t.length++,e.init()}}(this),_=this.component.config.components,a=0,h=_.length;h>a;a++)if(s=_[a],m={},s instanceof Array)for(r=t(s[1]),v=o(s[0]),l=0,p=v.length;p>l;l++)g=v[l],n(new e.Component(this,{path:path,"extends":r}));else if("string"==typeof s)for(y=o(s),u=0,c=y.length;c>u;u++)g=y[u],n(new e.Component(this,{name:g}));else for(s["extends"]=t(s["extends"]),E=o(s.name),d=0,f=E.length;f>d;d++)g=E[d],s.name=g,n(new e.Component(this,s))},n.prototype.__componentRender=function(t){var e,n,r,o;if(0===this.length)this.triggerEvent("ready");else for(this.total=0,o=this._data,n=0,r=o.length;r>n;n++)e=o[n],e.controller.addEvent("ready",function(){return++this.total===this.length?this.triggerEvent("ready"):void 0},this,1),e[t]()},n.prototype.render=function(){this.__componentRender("render")},n.prototype.rerender=function(){this.__componentRender("rerender")},n.prototype.whereData=function(t,e){var n,r,o,i,s,a,l;l=[],r=this._data;for(n in r){o=r[n],s=o.model.data||model.data;for(i in s)a=s[i],i===t&&a===e&&l.push(o)}return l},n.prototype.reset=function(){var t,e,r,o;for(o=this._data,e=0,r=o.length;r>e;e++)t=o[e],t.destroy();n.__super__.reset.call(this)},n}(e.Collection),e.History=function(t){function e(){this.__checkChanged=a(this.__checkChanged,this),"undefined"!=typeof window&&(this.location=(this.window=window).location,this.history=window.history)}var r;return i(e,t),e.prototype.usePush=!0,e.prototype.useHash=!1,e.prototype.started=!1,e.prototype.root="/",e.prototype.iframe=null,e.prototype.url=null,e.prototype.__interval=null,e.prototype.intervalRate=50,e.prototype.start=function(t){var e,r,o,i,s,a,l;return null==t&&(t={}),this.started?void 0:(this.started=!0,l=this.usePush=t.useHash?!1:null!=(i=this.history)?i.pushState:void 0,a=this.useHash=!l,(t.forceRefresh||a&&!("onhashchange"in this.window))&&(this.usePush=this.useHash=a=l=!1),t.interval&&(this.intervalRate=t.interval),this.root=n=("/"+(t.root||"/")+"/").replace(/^\/+|\/+$/g,"/"),this.url=s=this.__getURL(),o=this.location,a?this.location.replace(n+"#"+this.__getPath()+this.__getHash()):l&&""!==this.__getHash()&&this.set(this.__getHash(),{replace:!0}),l||a||t.forceRefresh||(r=document.createElement("iframe"),r.src="javascript:0",r.style.display="none",r.tabIndex=-1,e=document.body,this.iframe=e.insertBefore(r,e.firstChild).contentWindow,this.__setHash(this.iframe,"#"+s,!1)),this.__toggleListeners(),t.silent?void 0:this.triggerEvent("changed",this.url.replace(/^\/+/,"")))},e.prototype.stop=function(){return this.__toggleListeners("remove"),this.started=!1},e.prototype.set=function(t,e){var r,o;if(null==e&&(e={}),this.started&&(null==e.silent&&(e.silent=!0),o=e.replace,t=this.__getURL(t)||"",n=this.root,(""===t||"?"===t.charAt(0))&&(n=n.slice(0,-1)||"/"),r=""+n+t.replace(/^\/*/,""),t=decodeURI(t.replace(/#.*$/,"")),this.url!==t)){if(this.url=t,this.usePush)this.history[o?"replaceState":"pushState"]({},document.title,r);else{if(!this.useHash)return void this.location.assign(fullURL);this.__setHash(this.window,t,o),this.iframe&&t!==this.__getHash(this.iframe)&&this.__setHash(this.iframe,t,o)}e.silent||this.triggerEvent("changed",(this.url=t).replace(/^\/+/,""))}},r=function(t,e,n){var r;return window.addEventListener?element[t+"EventListener"](e,n):window.attachEvent?(r="on"===t?"attach":"detach",element[r+"Event"]("prefix"+e,n)):element[t+e]=n},e.prototype.__toggleListeners=function(t){null==t&&(t="add"),this.pushState?r("popstate",this.__checkChanged):this.useHash&&!this.iframe?r("hashchange",this.__checkChanged):this.useHash&&("add"===t?this.__interval=setInterval(this.__checkChanged,this.intervalRate):(clearInterval(this.__interval),document.body.removeChild(this.iframe.frameElement),this.iframe=this.__interval=null))},e.prototype.__getHash=function(t){var e;return e=(t||this).location.href.match(/#(.*)$/),e?e[1]:""},e.prototype.__getSearch=function(){var t;return t=this.location.href.replace(/#.*/,"").match(/\?.+/),t?t[0]:""},e.prototype.__getPath=function(){var t;return t=decodeURI(""+this.location.pathname+this.__getSearch()),n=this.root.slice(0,-1),t.indexOf(n)||(t=t.slice(n.length)),"/"===t.charAt(0)?t.slice(1):t},e.prototype.__getURL=function(t,e){return null==t&&(this.usePush||e?(t=decodeURI(""+this.location.pathname+this.location.search),n=this.root.replace(/\/$/,""),t.indexOf(n)||(t=t.slice(n.length))):t=this.__getHash()),t=t.replace(/^\/{2,}/g,"/"),t.match(/^\/+/)||(t="/"+t),t.replace(/\/+$/g,"")},e.prototype.__setHash=function(t,e,n){this.iframe===t&&t.document.open().close(),n?t.location.replace(location.href.replace(/(javascript:|#).*$/,"")+"#"+e):t.location.hash=""+e},e.prototype.__checkChanged=function(){var t,e;if(t=this.__getURL(),e=this.url,t===e){if(!this.iframe)return!1;t=this.__getHash(this.iframe),this.set(t)}return this.triggerEvent("changed",this.url=t),!0},e}(e.Events),e.History=new e.History,e.Router=function(t){function n(t){this.routes=null!=t?t:{},e.History.addEvent("changed",this.__urlChanged,this)}var r,o,s,a;return i(n,t),n.prototype.add=function(t,e){null!=this.routes[t]?this.routes[t].push(e):this.routes[t]=[e]},n.prototype.remove=function(t,e){var n,r,o,i,s,a;if(a=this.routes[t],"string"==typeof e)for(i=(" "+e.replace(/\s+/g," ")+" ").split(" "),n=0,o=i.length;o>n;n++)s=i[n],a=(" "+a.join(" ")+" ").split(" "+s+" ");else for(r in a)s=a[r],s===e&&delete a[r];this.routes[t]=a,null==a||null!=e&&0!==a.length||delete this.routes[t]},s=/\/?[?:]([^?\/:]*)/g,o=function(t){var e,n,r,o,i,s,a,l;if(l=/^.*\?(.+)/.exec(t)){if(i=/([^&]+)&*/.exec(l[1]))for(e=0,r=i.length;r>e;e++)o=i[e],t={},a=/(.+)[:=]+(.+)|(.+)/.exec(t),a&&(n=a[3]||a[1],s=a[2]||"true",t[n]=s)}else t&&(t=t.replace(/\?/g,""));return t},a=function(t){var e,n;return e=/[\-\\\^\[\]\s{}+.,$|#]/g,n=/\/?(\*)$/,t=t.replace(e,"\\$&"),t=t.replace(s,function(t){var e;return e="\\/?([^\\/]*?)",/^\/?\?/.exec(t)?"(?:"+e+")?":e}),t=t.replace(n,"\\/?(.*?)"),new RegExp("^"+t+"[\\/\\s]?$")},r=function(t){var e;return e=t.match(s)||[],e.push("splat"),e},n.prototype.__urlChanged=function(t){var e,n,i,s,l,u,h,p,c,f;t=t.replace(/^\/+|\/+$/g,""),u=this.routes,p=[];for(e in u)f=u[e],p.push(function(){var u,p,d,g,m,_;for(_=[],u=0,d=f.length;d>u;u++)if(c=f[u],s=[],"string"==typeof c&&(s=r(c),c=a(c)),l=c.exec(t)){for(h={url:t,data:{}},l.splice(0,1),i=0,p=0,g=l.length;g>p;p++)n=l[p],h.data[(null!=(m=s[i])?m.replace(/^[?:\/]*/,""):void 0)||i]=o(n),i++;_.push(this.triggerEvent(e,h))}else _.push(void 0);return _}.call(this));return p},n}(e.Events)}).call(this);
//# sourceMappingURL=lib/tweak.min.js.map